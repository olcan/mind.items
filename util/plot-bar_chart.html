<div id="bar_chart-__cid__" class="c3 __classes__" __style__>
  <script>
    const { data, options } = _this.store['bar_chart-__cid__']
    const { labels, values, baseline } = data
    let change
    if (baseline)
      change = values
        .map((x, i) => x - baseline[i])
        .map(d3.format(options.y_format))
    c3._chart(
      '#bar_chart-__cid__',
      merge(
        {
          data: {
            x: 'x',
            columns: [
              ['x', ...labels],
              ...(baseline ? [[options.baseline_label, ...baseline]] : []),
              [options.y_label, ...values],
              ...(change ? [[options.change_label, ...change]] : []),
            ],
            type: 'bar',
            colors: _.fromPairs([
              [options.y_label, baseline ? '#d61' : 'gray'],
              [options.baseline_label, 'gray'],
              [options.change_label, '#48d'],
            ]),
          },
          bar: { space: 0.25 },
          axis: {
            x: {
              type: 'category',
              tick: {
                rotate: options.x_tick_angle,
                culling: { max: options.x_ticks },
              },
            },
            y: {
              show: options.y_axis,
              tick: { count: 5, format: d3.format(options.y_format) },
            },
          },
          legend: { show: baseline != undefined },
          // https://stackoverflow.com/a/51570780
          title: { text: options.label, position: options.label_position },
          // TODO: doesn't this disable the leak checker? also feels like
          //       a poor hack for label positioning
          // onrendered: function () {
          //   if (options.label && options.label_position.endsWith('left'))
          //     d3.select(this.config.bindto).select('.c3-title').attr('x', 5)
          // },
        },
        options
      )
    )
  </script>
</div>
